
R version 3.4.0 (2017-04-21) -- "You Stupid Darkness"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> rm(list = ls())
> 
> setwd("~/git/gradient-forest/experiments/instrumental_ci_test2")
> 
> library(gradient.forest)
> 
> #
> #
> # PROBLEM CONFIGURATION
> #
> #
> 
> alpha.tau = 1
> alpha.mu.vals = 1
> sigma = 1
> confounding.vals = 1
> axis.aligned.vals = c(TRUE, FALSE)
> 
> k.tau.vals = c(2, 4)
> k.mu = 2
> p.vals = c(6, 12, 18)
> 
> n.vals = c(2000, 4000, 8000)
> n.test = 1000
> 
> REPS = 20
> 
> for (alpha.mu in alpha.mu.vals) {
+ for (confounding in confounding.vals) {
+ for (axis.aligned in axis.aligned.vals) {
+ for (k.tau in k.tau.vals) {
+ for (p in p.vals) {
+ for (n in n.vals) {
+ 
+ p = max(p, k.tau + k.mu)
+ 
+ res.all = replicate(REPS, {
+ 
+ #
+ #
+ # DATA GENERATION
+ #
+ #
+ 
+ X = matrix(rnorm(n * p), n, p)
+ eps = rnorm(n)
+ Z = rbinom(n, 1, 2/3)
+ filter = rbinom(n, 1, 1/(1 + exp(-confounding * eps)))
+ W = Z * filter
+ 
+ if(axis.aligned) {
+   tau = alpha.tau * apply(X[,1:k.tau], 1, function(xx) sum(pmax(0, xx)))
+   mu = alpha.mu *  apply(X[,k.tau + 1:k.mu], 1, function(xx) sum(pmax(0, xx)))
+ } else {
+   tau = alpha.tau * pmax(0, rowSums(X[,1:k.tau]))
+   mu = alpha.mu * pmax(0, rowSums(X[,k.tau + 1:k.mu]))
+ }
+ 
+ Y = (2 * W - 1) / 2 * tau + mu + eps
+ 
+ X.test = matrix(rnorm(n.test * p), n.test, p)
+ if(axis.aligned) {
+   tau.true = alpha.tau *  apply(X.test[,1:k.tau], 1, function(xx) sum(pmax(0, xx)))
+ } else {
+   tau.true = alpha.tau * pmax(0, rowSums(X.test[,1:k.tau]))
+ }
+ 
+ #
+ #
+ # RUN EXPERIMENT
+ #
+ #
+ 
+ forest.orthog = instrumental.forest(X, Y, W, Z, precompute.nuisance = TRUE, num.trees = 4000, ci.group.size = 10)
+ tau.forest.orthog = predict(forest.orthog, newdata = X.test, estimate.variance = TRUE)
+ tau.hat = tau.forest.orthog$predictions
+ sigma.hat = sqrt(tau.forest.orthog$variance.estimates)
+ 
+ covered = (abs(tau.hat - tau.true) / sigma.hat <= 1.96)
+ 
+ print(mean(covered))
+ return(mean(covered))
+ 
+ })
+ 
+ print(paste("CONFIG", alpha.tau, alpha.mu, sigma, confounding, axis.aligned, k.tau, k.mu, p, n, sep="-"))
+ print(mean(res.all))
+ 
+ write.table(res.all, file=paste("output/out", alpha.tau, alpha.mu, sigma, confounding, axis.aligned, k.tau, k.mu, p, n, "results.csv", sep="-"), row.names=FALSE, col.names=FALSE, sep=",")
+ 
+ }}}}}}
[1] 0.868
[1] 0.801
[1] 0.915
[1] 0.937
[1] 0.913
[1] 0.941
[1] 0.915
[1] 0.943
[1] 0.957
[1] 0.862
[1] 0.881
[1] 0.942
[1] 0.918
[1] 0.929
[1] 0.899
[1] 0.933
[1] 0.938
[1] 0.886
[1] 0.923
[1] 0.947
[1] "CONFIG-1-1-1-1-TRUE-2-2-6-2000"
[1] 0.9124
[1] 0.903
[1] 0.918
[1] 0.859
[1] 0.947
[1] 0.917
[1] 0.94
[1] 0.89
[1] 0.947
[1] 0.93
[1] 0.946
[1] 0.943
[1] 0.902
[1] 0.927
[1] 0.95
[1] 0.915
[1] 0.926
[1] 0.908
[1] 0.925
[1] 0.905
[1] 0.925
[1] "CONFIG-1-1-1-1-TRUE-2-2-6-4000"
[1] 0.92115
[1] 0.919
[1] 0.953
[1] 0.956
[1] 0.927
[1] 0.931
[1] 0.925
[1] 0.945
[1] 0.896
[1] 0.935
[1] 0.933
[1] 0.944
[1] 0.946
[1] 0.927
[1] 0.898
[1] 0.937
[1] 0.906
[1] 0.936
[1] 0.936
[1] 0.954
[1] 0.924
[1] "CONFIG-1-1-1-1-TRUE-2-2-6-8000"
[1] 0.9314
[1] 0.828
[1] 0.836
[1] 0.882
[1] 0.878
[1] 0.826
[1] 0.833
[1] 0.858
[1] 0.817
[1] 0.917
[1] 0.915
[1] 0.811
[1] 0.802
[1] 0.75
[1] 0.826
[1] 0.873
[1] 0.933
[1] 0.749
[1] 0.904
[1] 0.818
[1] 0.912
[1] "CONFIG-1-1-1-1-TRUE-2-2-12-2000"
[1] 0.8484
[1] 0.902
[1] 0.939
[1] 0.964
[1] 0.85
[1] 0.955
[1] 0.928
[1] 0.944
[1] 0.876
[1] 0.856
[1] 0.92
[1] 0.907
[1] 0.904
[1] 0.914
[1] 0.921
[1] 0.929
[1] 0.92
[1] 0.958
[1] 0.922
[1] 0.9
[1] 0.86
[1] "CONFIG-1-1-1-1-TRUE-2-2-12-4000"
[1] 0.91345
[1] 0.955
[1] 0.922
[1] 0.939
[1] 0.933
[1] 0.957
[1] 0.96
[1] 0.939
[1] 0.974
[1] 0.924
[1] 0.954
[1] 0.945
[1] 0.951
[1] 0.929
[1] 0.957
[1] 0.898
[1] 0.962
[1] 0.939
[1] 0.914
[1] 0.917
[1] 0.947
[1] "CONFIG-1-1-1-1-TRUE-2-2-12-8000"
[1] 0.9408
[1] 0.902
[1] 0.812
[1] 0.829
[1] 0.869
[1] 0.816
[1] 0.887
[1] 0.787
[1] 0.622
[1] 0.878
[1] 0.768
[1] 0.903
[1] 0.822
[1] 0.952
[1] 0.931
[1] 0.776
[1] 0.804
[1] 0.892
[1] 0.867
[1] 0.975
[1] 0.891
[1] "CONFIG-1-1-1-1-TRUE-2-2-18-2000"
[1] 0.84915
[1] 0.928
[1] 0.899
[1] 0.924
[1] 0.949
[1] 0.826
[1] 0.932
[1] 0.93
[1] 0.921
[1] 0.823
[1] 0.896
[1] 0.933
[1] 0.963
[1] 0.926
[1] 0.866
[1] 0.905
[1] 0.881
[1] 0.908
[1] 0.877
[1] 0.943
[1] 0.887
[1] "CONFIG-1-1-1-1-TRUE-2-2-18-4000"
[1] 0.90585
[1] 0.949
[1] 0.932
[1] 0.946
[1] 0.954
[1] 0.956
[1] 0.953
[1] 0.936
[1] 0.95
[1] 0.937
[1] 0.964
[1] 0.957
[1] 0.923
[1] 0.934
[1] 0.961
[1] 0.96
[1] 0.923
[1] 0.949
[1] 0.963
[1] 0.917
[1] 0.924
[1] "CONFIG-1-1-1-1-TRUE-2-2-18-8000"
[1] 0.9444
[1] 0.905
[1] 0.876
[1] 0.925
[1] 0.86
[1] 0.831
[1] 0.756
[1] 0.822
[1] 0.834
[1] 0.789
[1] 0.851
[1] 0.896
[1] 0.854
[1] 0.867
[1] 0.816
[1] 0.867
[1] 0.826
[1] 0.852
[1] 0.835
[1] 0.891
[1] 0.852
[1] "CONFIG-1-1-1-1-TRUE-4-2-6-2000"
[1] 0.85025
[1] 0.866
[1] 0.853
[1] 0.863
[1] 0.864
[1] 0.854
[1] 0.862
[1] 0.947
[1] 0.811
[1] 0.905
[1] 0.888
[1] 0.87
[1] 0.892
[1] 0.874
[1] 0.846
[1] 0.851
[1] 0.869
[1] 0.844
[1] 0.866
[1] 0.869
[1] 0.86
[1] "CONFIG-1-1-1-1-TRUE-4-2-6-4000"
[1] 0.8677
[1] 0.913
[1] 0.856
[1] 0.883
[1] 0.905
[1] 0.908
[1] 0.906
[1] 0.888
[1] 0.898
[1] 0.917
[1] 0.911
[1] 0.896
[1] 0.919
[1] 0.887
[1] 0.897
[1] 0.878
[1] 0.9
[1] 0.898
[1] 0.875
[1] 0.913
[1] 0.892
[1] "CONFIG-1-1-1-1-TRUE-4-2-6-8000"
[1] 0.897
[1] 0.693
[1] 0.62
[1] 0.779
[1] 0.73
[1] 0.685
[1] 0.804
[1] 0.829
[1] 0.74
[1] 0.785
[1] 0.702
[1] 0.81
[1] 0.746
[1] 0.703
[1] 0.798
[1] 0.76
[1] 0.751
[1] 0.777
[1] 0.707
[1] 0.813
[1] 0.795
[1] "CONFIG-1-1-1-1-TRUE-4-2-12-2000"
[1] 0.75135
[1] 0.875
[1] 0.835
[1] 0.736
[1] 0.809
[1] 0.837
[1] 0.786
[1] 0.72
[1] 0.788
[1] 0.786
[1] 0.835
[1] 0.795
[1] 0.734
[1] 0.834
[1] 0.864
[1] 0.857
[1] 0.815
[1] 0.746
[1] 0.799
[1] 0.743
[1] 0.863
[1] "CONFIG-1-1-1-1-TRUE-4-2-12-4000"
[1] 0.80285
[1] 0.882
[1] 0.851
[1] 0.852
[1] 0.801
[1] 0.876
[1] 0.844
[1] 0.863
[1] 0.874
[1] 0.9
[1] 0.807
[1] 0.873
[1] 0.877
[1] 0.86
[1] 0.868
[1] 0.842
[1] 0.844
[1] 0.842
[1] 0.89
[1] 0.87
[1] 0.858
[1] "CONFIG-1-1-1-1-TRUE-4-2-12-8000"
[1] 0.8587
[1] 0.664
[1] 0.625
[1] 0.714
[1] 0.554
[1] 0.698
[1] 0.609
[1] 0.644
[1] 0.642
[1] 0.646
[1] 0.721
[1] 0.701
[1] 0.605
[1] 0.682
[1] 0.664
[1] 0.725
[1] 0.761
[1] 0.571
[1] 0.731
[1] 0.689
[1] 0.556
[1] "CONFIG-1-1-1-1-TRUE-4-2-18-2000"
[1] 0.6601
[1] 0.781
[1] 0.707
[1] 0.799
[1] 0.698
[1] 0.792
[1] 0.672
[1] 0.776
[1] 0.863
[1] 0.761
[1] 0.785
[1] 0.722
[1] 0.712
[1] 0.653
[1] 0.823
[1] 0.78
[1] 0.756
[1] 0.841
[1] 0.768
[1] 0.777
[1] 0.828
[1] "CONFIG-1-1-1-1-TRUE-4-2-18-4000"
[1] 0.7647
[1] 0.862
[1] 0.797
[1] 0.75
[1] 0.825
[1] 0.839
[1] 0.819
[1] 0.826
[1] 0.802
[1] 0.826
[1] 0.838
[1] 0.747
[1] 0.796
[1] 0.903
[1] 0.745
[1] 0.797
[1] 0.782
[1] 0.809
[1] 0.811
[1] 0.81
[1] 0.847
[1] "CONFIG-1-1-1-1-TRUE-4-2-18-8000"
[1] 0.81155
[1] 0.908
[1] 0.909
[1] 0.874
[1] 0.886
[1] 0.885
[1] 0.871
[1] 0.817
[1] 0.878
[1] 0.923
[1] 0.936
[1] 0.905
[1] 0.858
[1] 0.925
[1] 0.855
[1] 0.878
[1] 0.93
[1] 0.903
[1] 0.903
[1] 0.877
[1] 0.911
[1] "CONFIG-1-1-1-1-FALSE-2-2-6-2000"
[1] 0.8916
[1] 0.941
[1] 0.907
[1] 0.895
[1] 0.894
[1] 0.92
[1] 0.939
[1] 0.94
[1] 0.92
[1] 0.943
[1] 0.875
[1] 0.905
[1] 0.904
[1] 0.95
[1] 0.929
[1] 0.934
[1] 0.876
[1] 0.936
[1] 0.919
[1] 0.92
[1] 0.935
[1] "CONFIG-1-1-1-1-FALSE-2-2-6-4000"
[1] 0.9191
[1] 0.923
[1] 0.933
[1] 0.914
[1] 0.932
[1] 0.955
[1] 0.909
[1] 0.934
[1] 0.932
[1] 0.936
[1] 0.92
[1] 0.934
[1] 0.894
[1] 0.951
[1] 0.926
[1] 0.938
[1] 0.94
[1] 0.915
[1] 0.939
[1] 0.953
[1] 0.935
[1] "CONFIG-1-1-1-1-FALSE-2-2-6-8000"
[1] 0.93065
[1] 0.856
[1] 0.77
[1] 0.913
[1] 0.939
[1] 0.885
[1] 0.861
[1] 0.871
[1] 0.796
[1] 0.765
[1] 0.883
[1] 0.816
[1] 0.834
[1] 0.875
[1] 0.79
[1] 0.82
[1] 0.902
[1] 0.873
[1] 0.856
[1] 0.896
[1] 0.879
[1] "CONFIG-1-1-1-1-FALSE-2-2-12-2000"
[1] 0.854
[1] 0.857
[1] 0.921
[1] 0.876
[1] 0.913
[1] 0.966
[1] 0.891
[1] 0.898
[1] 0.875
[1] 0.896
[1] 0.853
[1] 0.911
[1] 0.928
[1] 0.887
[1] 0.905
[1] 0.884
[1] 0.922
[1] 0.894
[1] 0.827
[1] 0.829
[1] 0.891
[1] "CONFIG-1-1-1-1-FALSE-2-2-12-4000"
[1] 0.8912
[1] 0.94
[1] 0.942
[1] 0.907
[1] 0.931
[1] 0.91
[1] 0.923
[1] 0.919
[1] 0.948
[1] 0.915
[1] 0.936
[1] 0.948
[1] 0.965
[1] 0.947
[1] 0.918
[1] 0.915
[1] 0.954
[1] 0.91
[1] 0.917
[1] 0.926
[1] 0.917
[1] "CONFIG-1-1-1-1-FALSE-2-2-12-8000"
[1] 0.9294
[1] 0.799
[1] 0.822
[1] 0.861
[1] 0.837
[1] 0.755
[1] 0.74
[1] 0.815
[1] 0.842
[1] 0.804
[1] 0.789
[1] 0.836
[1] 0.848
[1] 0.862
[1] 0.822
[1] 0.911
[1] 0.79
[1] 0.819
[1] 0.838
[1] 0.889
[1] 0.717
[1] "CONFIG-1-1-1-1-FALSE-2-2-18-2000"
[1] 0.8198
[1] 0.876
[1] 0.908
[1] 0.876
[1] 0.867
[1] 0.928
[1] 0.806
[1] 0.909
[1] 0.853
[1] 0.894
[1] 0.806
[1] 0.868
[1] 0.929
[1] 0.861
[1] 0.865
[1] 0.884
[1] 0.876
[1] 0.902
[1] 0.871
[1] 0.838
[1] 0.854
[1] "CONFIG-1-1-1-1-FALSE-2-2-18-4000"
[1] 0.87355
[1] 0.894
[1] 0.936
[1] 0.89
[1] 0.959
[1] 0.901
[1] 0.929
[1] 0.941
[1] 0.906
[1] 0.939
[1] 0.903
[1] 0.922
[1] 0.866
[1] 0.924
[1] 0.928
[1] 0.913
[1] 0.95
[1] 0.844
[1] 0.915
[1] 0.916
[1] 0.925
[1] "CONFIG-1-1-1-1-FALSE-2-2-18-8000"
[1] 0.91505
[1] 0.788
[1] 0.912
[1] 0.877
[1] 0.883
[1] 0.859
[1] 0.842
[1] 0.809
[1] 0.84
[1] 0.807
[1] 0.877
[1] 0.814
[1] 0.829
[1] 0.849
[1] 0.855
[1] 0.814
[1] 0.847
[1] 0.802
[1] 0.791
[1] 0.736
[1] 0.783
[1] "CONFIG-1-1-1-1-FALSE-4-2-6-2000"
[1] 0.8307
[1] 0.798
[1] 0.844
[1] 0.778
[1] 0.824
[1] 0.846
[1] 0.822
[1] 0.793
[1] 0.837
[1] 0.806
[1] 0.753
[1] 0.861
[1] 0.858
[1] 0.846
[1] 0.864
[1] 0.867
[1] 0.834
[1] 0.779
[1] 0.781
[1] 0.864
[1] 0.827
[1] "CONFIG-1-1-1-1-FALSE-4-2-6-4000"
[1] 0.8241
[1] 0.833
[1] 0.879
[1] 0.863
[1] 0.838
[1] 0.87
[1] 0.829
[1] 0.831
[1] 0.845
[1] 0.868
[1] 0.842
[1] 0.858
[1] 0.855
[1] 0.872
[1] 0.882
[1] 0.861
[1] 0.845
[1] 0.856
[1] 0.848
[1] 0.863
[1] 0.862
[1] "CONFIG-1-1-1-1-FALSE-4-2-6-8000"
[1] 0.855
[1] 0.665
[1] 0.794
[1] 0.777
[1] 0.795
[1] 0.727
[1] 0.676
[1] 0.749
[1] 0.681
[1] 0.628
[1] 0.613
[1] 0.639
[1] 0.66
[1] 0.719
[1] 0.761
[1] 0.758
[1] 0.709
[1] 0.656
[1] 0.591
[1] 0.808
[1] 0.689
[1] "CONFIG-1-1-1-1-FALSE-4-2-12-2000"
[1] 0.70475
[1] 0.746
[1] 0.771
[1] 0.724
[1] 0.771
[1] 0.759
[1] 0.728
[1] 0.773
[1] 0.83
[1] 0.734
[1] 0.764
[1] 0.683
[1] 0.681
[1] 0.734
[1] 0.764
[1] 0.789
[1] 0.75
[1] 0.699
[1] 0.838
[1] 0.809
[1] 0.748
[1] "CONFIG-1-1-1-1-FALSE-4-2-12-4000"
[1] 0.75475
[1] 0.795
[1] 0.801
[1] 0.811
[1] 0.804
[1] 0.774
[1] 0.763
[1] 0.775
[1] 0.806
[1] 0.813
[1] 0.83
[1] 0.713
[1] 0.774
[1] 0.765
[1] 0.701
[1] 0.758
[1] 0.749
[1] 0.795
[1] 0.716
[1] 0.785
[1] 0.782
[1] "CONFIG-1-1-1-1-FALSE-4-2-12-8000"
[1] 0.7755
[1] 0.635
[1] 0.712
[1] 0.769
[1] 0.595
[1] 0.735
[1] 0.593
[1] 0.712
[1] 0.64
[1] 0.673
[1] 0.737
[1] 0.701
[1] 0.74
[1] 0.677
[1] 0.759
[1] 0.662
[1] 0.735
[1] 0.743
[1] 0.596
[1] 0.599
[1] 0.716
[1] "CONFIG-1-1-1-1-FALSE-4-2-18-2000"
[1] 0.68645
[1] 0.734
[1] 0.75
[1] 0.764
[1] 0.728
[1] 0.677
[1] 0.74
[1] 0.729
[1] 0.739
[1] 0.709
[1] 0.718
[1] 0.773
[1] 0.718
[1] 0.655
[1] 0.777
[1] 0.703
[1] 0.738
[1] 0.747
[1] 0.763
[1] 0.709
[1] 0.65
[1] "CONFIG-1-1-1-1-FALSE-4-2-18-4000"
[1] 0.72605
[1] 0.734
[1] 0.778
[1] 0.783
[1] 0.782
[1] 0.715
[1] 0.759
[1] 0.778
[1] 0.743
[1] 0.763
[1] 0.737
[1] 0.696
[1] 0.776
[1] 0.756
[1] 0.737
[1] 0.76
[1] 0.725
[1] 0.762
[1] 0.793
[1] 0.779
[1] 0.77
[1] "CONFIG-1-1-1-1-FALSE-4-2-18-8000"
[1] 0.7563
> 
> proc.time()
      user     system    elapsed 
213924.116   4441.313  43423.402 
0"
[1] 0.7496333
[1] 0.722
[1] 0.464
[1] 0.669
[1] 0.625
[1] 0.597
[1] 0.339
[1] 0.714
[1] 0.646
[1] 0.402
[1] 0.661
[1] 0.726
[1] 0.748
[1] 0.582
[1] 0.521
[1] 0.695
[1] 0.468
[1] 0.554
[1] 0.712
[1] 0.514
[1] 0.726
[1] 0.673
[1] 0.721
[1] 0.569
[1] 0.668
[1] 0.787
[1] 0.424
[1] 0.708
[1] 0.676
[1] 0.694
[1] 0.641
[1] 0.585
[1] 0.632
[1] 0.715
[1] 0.741
[1] 0.778
[1] 0.731
[1] 0.648
[1] 0.625
[1] 0.527
[1] 0.633
[1] 0.702
[1] 0.8
[1] 0.702
[1] 0.53
[1] 0.8
[1] 0.657
[1] 0.543
[1] 0.714
[1] 0.651
[1] 0.694
[1] 0.654
[1] 0.638
[1] 0.694
[1] 0.453
[1] 0.77
[1] 0.722
[1] 0.69
[1] 0.548
[1] 0.648
[1] 0.631
[1] "CONFIG-1-1-1-1-FALSE-4-2-20-1000"
[1] 0.6417
[1] 0.652
[1] 0.689
[1] 0.612
[1] 0.751
[1] 0.666
[1] 0.621
[1] 0.671
[1] 0.687
[1] 0.722
[1] 0.716
[1] 0.648
[1] 0.556
[1] 0.656
[1] 0.661
[1] 0.627
[1] 0.589
[1] 0.615
[1] 0.62
[1] 0.607
[1] 0.724
[1] 0.703
[1] 0.562
[1] 0.668
[1] 0.63
[1] 0.691
[1] 0.652
[1] 0.732
[1] 0.672
[1] 0.745
[1] 0.709
[1] 0.688
[1] 0.547
[1] 0.785
[1] 0.639
[1] 0.622
[1] 0.403
[1] 0.716
[1] 0.641
[1] 0.547
[1] 0.616
[1] 0.62
[1] 0.719
[1] 0.758
[1] 0.604
[1] 0.741
[1] 0.715
[1] 0.637
[1] 0.551
[1] 0.725
[1] 0.644
[1] 0.677
[1] 0.79
[1] 0.596
[1] 0.726
[1] 0.738
[1] 0.75
[1] 0.649
[1] 0.71
[1] 0.686
[1] 0.795
[1] "CONFIG-1-1-1-1-FALSE-4-2-20-2000"
[1] 0.6648167
> 
> proc.time()
    user   system  elapsed 
95133.40  1627.05 28014.28 
